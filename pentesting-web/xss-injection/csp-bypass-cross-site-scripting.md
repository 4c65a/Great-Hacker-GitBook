# CSP-Bypass Cross Site Scripting

Un mecanismo de seguridad del navegador que tiene como objetivo mitigar XSS y algunos otros ataques. Funciona restringiendo los recursos (como scripts e imágenes) que una página puede cargar y restringiendo si una página puede estar enmarcada por otras páginas.

Para habilitar CSP, una respuesta debe incluir un encabezado de respuesta HTTP llamado `Content-Security-Policy`con un valor que contenga la política.Mientras que bypass de CSP se refiere a técnicas que los atacantes pueden utilizar para evadir las restricciones de CSP.

**Ejemplos de técnicas de CSP-Bypass:**

1. **Data URIs:**
   * Inyectar código JavaScript directamente en la URL de un recurso.
   * Ejemplo: `javascript:alert('XSS');`
2. **Eventos DOM:**
   * Utilizar eventos DOM (como `onclick`, `onload`) para ejecutar código JavaScript.
   * Ejemplo: `<img src="" onerror="alert('XSS');">`
3. **Protocolos no estándar:**
   * Usar protocolos no estándar como `data:` o `javascript:` para cargar código JavaScript.
   * Ejemplo: `<script src="data:text/javascript,alert('XSS');"></script>`
4. **Inyección en fuentes permitidas:**
   * Encontrar fuentes permitidas por la CSP (como Google Analytics) y usarlas para alojar código malicioso.
   * Ejemplo: Inyectar código en comentarios de un blog que luego se cargan desde un dominio permitido.
5. **Desajustes de MIME types:**
   * Subir un archivo JavaScript con un MIME type incorrecto (como `image/jpeg`) para engañar a la CSP.
6. **Políticas CSP mal configuradas:**
   * Aprovechar configuraciones incorrectas o demasiado permisivas en la CSP.

**Consideraciones:**

* Las técnicas de CSP-Bypass suelen ser específicas a la configuración de la CSP en cada sitio web.
* Los atacantes buscan constantemente nuevas formas de evadir las restricciones de CSP.
* Es fundamental mantener la CSP actualizada y realizar pruebas de seguridad regulares para detectar y corregir vulnerabilidades XSS.

<mark style="color:red;">**Recursos**</mark>

{% embed url="https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass" %}

{% embed url="https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html" %}

{% embed url="https://portswigger.net/web-security/cross-site-scripting/content-security-policy" %}

{% embed url="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" %}

{% embed url="https://portswigger.net/web-security/cross-site-scripting/content-security-policy/lab-csp-bypass" %}
