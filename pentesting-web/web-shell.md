# Web Shell

La persistencia es el grupo general de técnicas utilizadas para mantener el acceso a un sistema, aplicación o entorno de destino (TAOOO3).

Este curso aborda específicamente una subtécnica ,llamada **T1505.003 Web Shell** .

Una shell web consta de uno o más scripts web cargados en un servidor web comprometido que habilitan funciones adicionales no autorizadas en ese servidor. Normalmente, esta funcionalidad equivale a una puerta trasera y puede habilitar funciones como la inyección remota de comandos, carga/descarga de archivos.

## ¿Como es una web shell?

Web Shells presentes en una variedad de formas y tamaños.

```php
<?php
if(isset($_REQUEST['_jwt'])){
  echo "<pre>";
  $cmd = ($_REQUEST['_jwt']);
  system('powershell.exe -ep bypass -c '.$cmd);
  echo "</pre>";
  die;
}
?>
```

Este archivo PHP básico es el componente del lado del servidor del shell web y permite a un adversario emitir comandos arbitrarios al servidor web en el que está alojado. Cualquier comando recibido por el archivo PHP a través del parámetro "\_jwt" en la URL se ejecutará como parte de un comando de PowerShell con el parámetro agregado de omitir la política de ejecución del sistema local. Al utilizar este shell web, un adversario podría ejecutar cualquier comando que pueda ejecutarse a través de PowerShell en el objetivo, y cualquier comando emitido de esta manera probablemente será ejecutado por el proceso del servidor web y bajo los permisos con los que opera.

**Ejemplos más complejos**

Los Web Shells también pueden ser puertas traseras más complicadas y con todas las funciones. Por ejemplo, la bifurcación del popular [shell web PHP C99](https://github.com/cermmik/C99-WebShell/blob/master/c99shell.php) contiene casi 5000 líneas de código y una variedad de funciones más fáciles de usar.

**¿Dónde se encuentran?**

Los shells web generalmente se colocan en una ubicación donde serán atendidos por el propio servidor web, generalmente dentro de la estructura de directorios debajo de la raíz web. Por ejemplo:

* Webroot típico de IIS: \inetpub\wwwroot o sus subdirectorios.
* Webroot típico de Apache: /var/www o sus subdirectorios.

Es posible que necesite determinar la raíz web para su aplicación de servidor web específica. Estas asignaciones de directorios se pueden personalizar. Para obtener mayor claridad sobre los directorios de shell web viables, consulte la configuración de los servidores web en su entorno y tenga en cuenta específicamente la raíz web, así como cualquier otro directorio que almacene componentes de aplicaciones dinámicas para el servidor web y cualquiera de sus complementos o complementos. .

Conocer los directorios válidos para el contenido web de servicios puede ser un punto especialmente importante para el análisis de detección. Es posible que pueda centrar medidas de detección personalizadas en la raíz web que pueden no ser viables en otros lugares, como la supervisión de eventos de gran volumen, como la creación y eliminación de archivos.

**Los riesgos**

El principal riesgo asociado con un **Web Shell** es el acceso no autorizado persistente y el control de un servidor web o de aplicaciones. Esto también puede ser cierto para cualquier otro dispositivo que tenga una consola web, que incluye una cantidad significativa de dispositivos especializados, incluidos algunos dispositivos de seguridad.

**Un ejemplo de flujo de ataque**

La carga de un Web Shell a un sistema de destino generalmente ocurre después de que se haya obtenido algún tipo de acceso inicial. Para los fines de la práctica de laboratorio de este curso, se hacen las siguientes suposiciones:

* El actor de amenazas ya obtuvo con éxito **el acceso inicial TA0001** al servidor de aplicaciones de destino.
* La forma de acceso obtenida por el actor de amenazas les permite cargar o escribir scripts web en una ubicación en el servidor de destino (u obligar al servidor de destino a descargar esos scripts) que haría que al menos una aplicación en ese servidor sirva ese script de vuelta. al actor de la amenaza.

**Pasos de ataque para este laboratorio**

El siguiente conjunto de pasos de ataque puede representar el uso de estas técnicas. Después de establecer el acceso inicial a través de **la aplicación de destino de explotación T1190** , el adversario puede optar por cargar un Web Shell. El método de carga puede variar y dependerá del tipo de Acceso Inicial obtenido. Por ejemplo, la carga útil de un exploit puede haber sido un comando para descargar un Web Shell desde el repositorio de herramientas del adversario (o incluso un repositorio público como GitHub) y escribir ese archivo en la raíz web del servidor de destino. Una vez que se haya logrado esto, un adversario normalmente intentará verificar el éxito iniciando una conexión al Web Shell, normalmente a través de alguna forma de HTTP/HTTPS.









<mark style="color:red;">**Recursos**</mark>

{% embed url="https://attack.mitre.org/tactics/TA0003/" %}

{% embed url="https://attack.mitre.org/techniques/T1505/003/" %}

{% embed url="https://www.akamai.com/blog/security-research/defeating-webshells-wso-ng" %}
