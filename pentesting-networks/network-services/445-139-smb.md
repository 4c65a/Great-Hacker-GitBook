---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# 445,139:SMB

## ¿Que es SMB?

Es un protocolo de intercambio de recursos y archivos de red que utiliza un modelo cliente-servidor,que controla el acceso a archivos y directorios enteros, así como a otros recursos de la red, como impresoras, _routers_ o interfaces compartidas con la red.

**Por defecto tiene el puerto:**

```bash
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
```

```bash
445/tcp  open  microsoft-ds
```

## Escanear

```bash
nmap -v -p 139,445 -sV -Pn 196.152.11.1 -oG smb.txt
```

```bash
nmap -p 139,445 -sV -Pn 196.152.11.1
```

```bash
nmap -p 196.152.11.1
```

### Script

```bash

#realiza auditorías de contraseñas por fuerza bruta en servidores SMB
nmap -v -p 139,445 --script smb-brute

#recopila información del sistema a través de SMB/NetBios
nmap -v -p 139,445 --script smb-system-info

#identifica si el servidor SMB es vulnerable a algún exploit conocido
nmap -v -p 139,445 --script smb-vuln-smb/cve*

# Escaneo de vulnerabilidad MS08-067 en los puertos 139 y 445
nmap -v -p 139,445 --script=smb-vuln-ms08-067 --script-args=unsafe=1

# Descubrimiento del sistema operativo a través del protocolo SMB en los puertos 139 y 445
nmap -p 139,445 --script smb-os-discovery 

# Modo de seguridad SMB en los puertos 137, 139 y 445
nmap -p 137,139,445 --script smb-security-mode 

# Modo de seguridad SMB en el puerto 137 utilizando UDP
nmap -sU -p 137 --script smb-security-mode 

# Vulnerabilidad MS08-067 en el puerto 445
nmap -p 445 --script smb-vuln-ms08-067 

# Exploración de vulnerabilidades SMB en el puerto 445
nmap -p 445 --script smb-vuln-* 

# Enumeración de usuarios a través del protocolo SMB en los puertos 139 y 445
nmap -v -p 139,445 --script smb-enum-users 

# Enumeración de usuarios a través del protocolo SMB en el puerto 137 (UDP)
nmap -sU -p 137 --script smb-enum-users --script-args samronly=true 

# Enumeración de usuarios a través del protocolo SMB en el puerto 137 (UDP) con LSA only
nmap -sU -p 137 --script smb-enum-users --script-args lsaonly=true 

# Enumeración de shares a través del protocolo SMB en los puertos 139 y 445
nmap -p 139,445 --script smb-enum-shares --script-args smbusername=Administrator,smbpassword=Password 

# Enumeración de shares a través del protocolo SMB en el puerto 137 (UDP)
nmap -sU -p 137 --script smb-enum-shares 

# Enumeración de sesiones a través del protocolo SMB en el puerto 445
nmap -p 445 --script smb-enum-sessions 

# Ataque de fuerza bruta SMB en el puerto 445
nmap -p 445 --script smb-brute --script-args userdb=users.txt,passdb=passwords.txt 

# Enumeración de sesiones a través del protocolo SMB en el puerto 137 (UDP)
nmap -sU -p 137 --script smb-enum-sessions 

# Detección de la puerta trasera DoublePulsar a través del protocolo SMB en el puerto 445
nmap -p 445 --script smb-vuln-double-pulsar-backdoor 

```

### Fuerza Bruta

```bash
hydra [-L users.txt or -l user_name] [-P pass.txt or -p password] -f [-S port] smb://X.X.X.X
```

### Enumeracion

```bash
smbclient [-U username] [-P password or -N for no password] -L \\\\X.X.X.X
```

```bash
smbclient [-U username] [-P password or -N for no password] \\\\X.X.X.X\\share
```





<mark style="color:red;">**Recursos**</mark>

{% embed url="https://www.ibm.com/docs/es/aix/7.3?topic=management-smb-protocol" %}

{% embed url="https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb" %}

{% embed url="https://aws.amazon.com/es/compare/the-difference-between-nfs-smb/" %}

{% embed url="https://secybr.com/posts/smb-pentesting-best-practices/" %}

{% embed url="https://7h3w4lk3rs-organization.gitbook.io/the-hive/network-attacks/network/smb" %}

{% embed url="https://steflan-security.com/smb-enumeration-guide/" %}
