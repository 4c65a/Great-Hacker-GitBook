---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Ataques basados ​​en Kerberos y LDAP

Kerberos es un protocolo de autenticación definido en RFC 4120 que Windows ha utilizado durante varios años.

Una implementación de Kerberos contiene tres elementos básicos:

* Cliente
* Servidor
* Centro de distribución de claves (KDC), incluido el servidor de autenticación y el servidor de concesión de tickets

### _Pasos de la autenticación Kerberos_

**Paso 1** . El cliente envía una solicitud al servidor de autenticación dentro del KDC.

**Paso 2** . El servidor de autenticación envía una clave de sesión y un ticket de concesión de tickets (TGT) que se utiliza para verificar la identidad del cliente.

**Paso 3** . El cliente envía el TGT al servidor de concesión de tickets.

**Paso 4** . El servidor que otorga tickets genera y envía un ticket al cliente.

**Paso 5** . El cliente presenta el ticket al servidor.

**Paso 6** . El servidor otorga acceso al cliente.

Active Directory utiliza el Protocolo ligero de acceso a directorios (LDAP) como protocolo de acceso. La implementación de LDAP de Windows admite la autenticación Kerberos. LDAP utiliza una estructura jerárquica de árbol invertido llamada árbol de información de directorio (DIT). En LDAP, cada entrada tiene una posición definida. El nombre distinguido (DN) representa la ruta completa de la entrada.

Uno de los ataques más comunes es el ataque del billete dorado de Kerberos. Un atacante puede manipular tickets de Kerberos en función de los hashes disponibles comprometiendo un sistema vulnerable y obteniendo las credenciales de usuario local y los hashes de contraseña. Si el sistema está conectado a un dominio, el atacante puede identificar un hash de contraseña Kerberos TGT (KRBTGT) para obtener el ticket dorado.



Empire es una herramienta popular que se puede utilizar para realizar billetes dorados y muchos otros tipos de ataques. Empire es básicamente un marco de trabajo posterior a la explotación que incluye un agente de Windows PowerShell puro y un agente de Python. Aprenderá más sobre las metodologías posteriores a la explotación más adelante en este módulo. Con Empire, puede ejecutar agentes PowerShell sin necesidad de utilizar powershell.exe. Puede descargar Empire y acceder a demostraciones, presentaciones y documentación en [_https://www.powershellempire.com_](https://www.powershellempire.com/) . El ejemplo 5-13 muestra el módulo golden\_ticket de Empire Mimikatz, que se puede utilizar para realizar un ataque de billete dorado. Cuando el módulo golden\_ticket de Empire Mimikatz se ejecuta en un sistema comprometido, el ticket dorado se establece para el usuario utilizando el hash de contraseña KRBTGT.
