---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Resolución de nombres de Windows

Existen varias tecnologías y protocolos de resolución de nombre a dirección IP, incluido el sistema básico de entrada/salida de red (NetBIOS), la resolución de nombres de multidifusión local de enlace (LLMNR) y el sistema de nombres de dominio (DNS).

## **Servicio de nombres NetBIOS y LLMNR**

NetBIOS y LLMNR son protocolos que Microsoft Windows utiliza principalmente para la identificación del host. LLMNR, que se basa en el formato del protocolo DNS, permite a los hosts en el mismo enlace local realizar la resolución de nombres para otros hosts. Por ejemplo, un host de Windows que intenta comunicarse con una impresora o una carpeta compartida de red puede usar NetBIOS

NetBIOS proporciona tres servicios diferentes:

* Servicio de nombres NetBIOS (NetBIOS-NS) para registro y resolución de nombres
* Servicio de datagramas (NetBIOS-DGM) para comunicación sin conexión
* Servicio de sesión (NetBIOS-SSN) para comunicación orientada a la conexión

Las operaciones relacionadas con NetBIOS utilizan los siguientes puertos y protocolos:

* **Puerto TCP 135:** asignador de puntos finales de llamada a procedimiento remoto de Microsoft (MS-RPC), utilizado para la comunicación de cliente a cliente y de servidor a cliente
* **Puerto UDP 137:** Servicio de nombres NetBIOS
* **Puerto UDP 138:** Servicio de datagramas NetBIOS
* **Puerto TCP 139:** Servicio de sesión NetBIOS
* **Puerto TCP 445:** protocolo SMB, utilizado para compartir archivos entre diferentes sistemas operativos, incluidos Windows y sistemas basados ​​en Unix.

Una vulnerabilidad común en LLMNR implica que un atacante suplanta una fuente autorizada para la resolución de nombres en un sistema víctima respondiendo al tráfico LLMNR a través del puerto UDP 5355 y al tráfico NBT-NS a través del puerto UDP 137. El atacante básicamente envenena el servicio LLMNR para manipular el sistema de la víctima. . Si el host solicitado pertenece a un recurso que requiere identificación o autenticación, el nombre de usuario y el hash NTLMv2 se envían al atacante. Luego, el atacante puede recopilar el hash enviado a través de la red utilizando herramientas como rastreadores. Posteriormente, el atacante puede aplicar fuerza bruta o descifrar los hashes fuera de línea para obtener las contraseñas en texto plano.

Se pueden utilizar varias herramientas para realizar este tipo de ataque, como NBNSpoof, Metasploit y Responder. Metasploit, por supuesto, es una de las herramientas y marcos más populares utilizados por los atacantes y los evaluadores de penetración. Otra herramienta de código abierto que es muy popular e incluso ha sido utilizada por malware es Pupy, que está disponible en GitHub. Pupy es una herramienta de post explotación y administración remota multiplataforma basada en Python que funciona en Windows, Linux, macOS e incluso Android.

Una de las mitigaciones comunes para este tipo de ataques es deshabilitar LLMNR y NetBIOS en la configuración de seguridad de la computadora local o configurar una política de grupo. Además, puede configurar políticas (reglas) de controles de acceso adicionales basadas en red o host para bloquear el tráfico LLMNR/NetBIOS si estos protocolos no son necesarios. Una de las técnicas de detección comunes para los ataques de envenenamiento LLMNR es monitorear la clave de registro HKLM\Software\Policies \Microsoft\Windows NT\DNSClient para detectar cambios en el valor DWORD EnableMulticast. Si ve un cero (0) para el valor de esa clave, sabrá que LLMNR está deshabilitado.

### Explotacion SMB&#x20;

Uno de los exploits para PYMES más utilizados en los últimos tiempos ha sido el exploit EternalBlue, que fue filtrado por una entidad llamada Shadow Brokers que supuestamente robó numerosos exploits de la Agencia de Seguridad Nacional de EE. UU. (NSA). La explotación exitosa de EternalBlue permite que un atacante remoto no autenticado comprometa un sistema afectado y ejecute código arbitrario. Este exploit se ha utilizado en ransomware como WannaCry y Nyeta. Este exploit se ha adaptado a muchas herramientas diferentes, incluido Metasploit.

```
```

msf> usar exploit/windows/smb/ms17\_010\_eternalblue
